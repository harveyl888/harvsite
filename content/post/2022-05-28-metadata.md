+++
author = "Harvey"
title = "Embedding metadata in R"
date = "2022-05-28"
description = "Three ways to embed metadata in R"
tags = ["R", "RMarkdown"]
codeMaxLines = 30
draft = true
+++

## Metadata in RMarkdown yaml

The yaml header of an RMarkdown file is the most straightforward way to add metadata.  The yaml can store metadata in the `params` parameter or as individual yaml parameters.  For example, the RMarkdown file below adds some metadata parameters to the header: short_title, reference and meta_list.  The `rmarkdown` function `rmarkdown::metadata` can be used to access the yaml parameters.

```markdown
---
title: "document title"
author: "author name"
short_title: "short"
reference: 1
output: "html_document"
params:
    name: "my name"
meta_list:
    meta: "meta 1"
---

test doc

`r rmarkdown::metadata$short_title`

`r params$name`

`r rmarkdown::metadata$meta_list$meta`

```
{{< figure src="/images/post-images/2022-05-28-metadata/metadata_01.png" >}}

In addition, the parameters can be accessed using the `rmarkdown::yaml_front_matter()` function.

```r
rmarkdown::yaml_front_matter("document.Rmd")

$title
[1] "document title"

$author
[1] "author name"

$short_title
[1] "short"

$reference
[1] 1

$output
[1] "html_document"

$params
$params$name
[1] "my name"


$meta_list
$meta_list$meta
[1] "meta 1"
```

## Metadata in *comment*

Metadata can be associated with any R object using `comment`.

```r
df <- data.frame(a = 1:5, b = letters[1:5])

## adding metadata through comment
comment(df) <- "This is my data frame"

## retrieving metadata (comment)
comment(df)
[1] "This is my data frame"

## retrieving metadata (attr)
attr(df, "comment")
[1] "This is my data frame"
```

The metadata, *This is my data frame* is stored as an attibute of `df` and can be retrieved using `comment(df)` or `attr(df, "comment")`.  The comment can be a character vector, allowing multiple, named strings to be attached.  For a more complex data structure a json object can be attached.  For example:

```r
df <- data.frame(a = 1:5, b = letters[1:5])

## adding metadata through comment
comment(df) <- jsonlite::toJSON(list(a = "This is my data frame", b = 1), auto_unbox = TRUE)

## retrieving metadata (comment)
comment(df)
{"a":"This is my data frame","b":1}
```

An interesting use-case is to add a JSON encoded comment to a function.  For example:

```r
f <- function(x, y) {
    sum(x, y)
}
comment(f) <- jsonlite::toJSON(list(f = "function: sum", param_count = 2))

## retrieving metadata (comment)
comment(f)
{"f":"function: sum","param_count":2} 
```



## Metadata in roxygen2

